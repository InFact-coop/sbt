<!DOCTYPE html>
<html lang="en">
<head>
  <title>Elm Boilerplate</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link href="https://fonts.googleapis.com/css?family=Fira+Sans|Playfair+Display:400,700" rel="stylesheet">
  <script type="text/javascript" src="elm.js"></script>
  <link rel="stylesheet" href="style.min.css" />

  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  <!-- <link rel='shortcut icon' type='image/x-icon' href='/assets/favicon.ico' /> -->
</head>

<body>
  <script>
  var app = Elm.Main.fullscreen();

  if (navigator.mediaDevices) {
    console.log('getUserMedia supported.');
    console.log('App: ' ,app);

    var constraints = { audio: true };
    var chunks = [];

    navigator.mediaDevices.getUserMedia(constraints)
    .then(function(stream) {
      var mediaRecorder = new MediaRecorder(stream);

  app.ports.recordStart.subscribe(function() {
    mediaRecorder.start();
    console.log(mediaRecorder.state);
    console.log("recorder started");
  });

  app.ports.recordStop.subscribe(function() {
    mediaRecorder.stop();
    console.log(mediaRecorder.state);
    console.log("recorder stopped");
  });

  mediaRecorder.onstop = function(e) {
    console.log("data available after MediaRecorder.stop() called.");

    var blob = new Blob(chunks, { 'type' : 'audio/ogg; codecs=opus' });
    chunks = [];
    // jstoelm
    var audioURL = window.URL.createObjectURL(blob);
    app.ports.audioUrl.send(audioURL);
    console.log('AudioURL: ', typeof audioURL);
    console.log("recorder stopped");
  };

  mediaRecorder.ondataavailable = function(e) {
    chunks.push(e.data);
  };
})
};
</script>
</body>

</html>
